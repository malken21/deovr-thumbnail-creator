# DeoVR Thumbnail Creator - 技術仕様報告書

このドキュメントは、DeoVR用VR180動画のサムネイル作成アプリケーション「DeoVR Thumbnail Creator」の技術構成と仕組みについてまとめたものです。

## 1. プロジェクト概要

本アプリケーションは、VR180形式（Side-by-Side）の動画ファイルを読み込み、3D空間上でプレビューしながら、テキストやスタンプを配置してサムネイル画像（1200x720px推奨サイズ）を作成・出力するデスクトップアプリケーションです。

## 2. 技術スタック (Tech Stack)

このシステムは、以下のモダンなWeb技術をベースとしたクロスプラットフォーム・デスクトップアプリとして構築されています。

| カテゴリ | 技術名 | 採用理由 / 役割 |
| :--- | :--- | :--- |
| **実行環境** | **Electron** | Web技術（HTML/JS）を使って、Windows/Mac両対応のネイティブアプリとして動作させるためのフレームワーク。OSのファイルシステムへのアクセス（動画読み込み・保存）を可能にします。 |
| **言語** | **TypeScript** | JavaScriptに「型」の概念を導入し、開発時のバグを防ぎ、コードの保守性を高めるために採用しています。 |
| **UIフレームワーク** | **React** | ユーザーインターフェース（画面）を構築するためのライブラリ。コンポーネント指向により、UIパーツ（ボタン、入力欄など）の再利用性と管理のしやすさを実現しています。 |
| **ビルドツール** | **Vite** | 非常に高速な開発サーバーとビルドツール。開発中のプレビュー更新を即座に行い、開発効率を最大化します。 |
| **3Dレンダリング** | **Three.js** (+ **React Three Fiber**) | ブラウザ上で3Dグラフィックスを描画するためのライブラリ。**VR180動画の半球投影（Sphere Mapping）** を実現するために不可欠なコア技術です。 |
| **状態管理** | **Zustand** | アプリケーション内のデータ（テキストの位置、フォント設定、読み込んだ画像の状態など）を一元管理するための軽量なライブラリ。Reduxよりもシンプルで高速です。 |
| **デザイン/CSS** | **Tailwind CSS** | クラス名を指定するだけでスタイルを適用できるCSSフレームワーク。開発スピードの向上と、デザインの統一感を維持するために使用しています。 |

## 3. アプリケーション・アーキテクチャ

システムは大きく分けて「メインプロセス（Electron）」と「レンダラープロセス（React UI）」の2つで構成されています。

### 3.1 メインプロセス (Main Process / Electron)
*   OSネイティブのウィンドウ管理（ウィンドウサイズ 1600x900 等の制御）。
*   セキュリティ設定（WebPreferences）の管理。
*   システムレベルのイベントハンドリング。

### 3.2 レンダラープロセス (Renderer Process / React UI)
ユーザーが実際に触れる画面部分です。以下の主要モジュールで構成されています。

1.  **Store (Zustand)**:
    *   `useStore.ts`: アプリの「脳」にあたる部分。動画のパス、再生状態、配置されたテキスト情報、スタンプ情報、テーマ設定など、すべての状態を一箇所で管理しています。
2.  **3D Viewer (Three.js / R3F)**:
    *   `SceneContainer.tsx`: 3Dシーンのコンテナ。
    *   `VideoSphere.tsx`: 動画をテクスチャとして3Dの球体（の内側）に貼り付け、VR180特有の歪みを再現してプレビュー表示します。
3.  **Overlays (Canvas Layers)**:
    *   `TextOverlay.tsx`: ユーザーが入力したテキストを画面上に重ねて表示します。フォント変更、色変更、縁取り機能などを持ちます。
    *   `StampOverlay.tsx`: 配置された画像スタンプを表示します。
4.  **Export System**:
    *   ボタン一つで現在のプレビュー画面（動画のフレーム＋テキスト＋スタンプ）を合成し、`canvas` APIを使用して一枚の画像データ（PNG）として書き出します。

## 4. 主な機能の実装詳細

### 動画プレビュー (VR180 Handling)
通常の動画プレーヤーとは異なり、VR動画を正しく表示するために、動画フレームをリアルタイムでテクスチャとして取得し、半球状のメッシュ（3Dオブジェクト）に投影しています。これにより、VRヘッドセットで見たときと同じような視界をシミュレーションしています。

### サムネイル合成フロー
1.  ユーザーが「エクスポート」ボタンを押す。
2.  **Canvas API** を使用して、メモリ上に 1200x720 の仮想キャンバスを作成。
3.  現在表示されている動画のフレームを描画。
4.  その上に、配置座標に基づいて「スタンプ画像」と「テキスト」を順番に重ねて描画。
5.  完成したキャンバスを `toDataURL` で画像データに変換し、ダウンロード（保存）処理を実行。

### カスタマイズ機能
*   **カスタムフォント**: ユーザーのローカルにあるフォントファイルを取り込み、`FontFace` APIを使って動的にWebフォントとして登録する仕組みを実装しています。
*   **テーマ切り替え**: `data-theme` 属性をHTMLルートに付与することで、アプリ全体の配色を一瞬で切り替えるCSS変数ベースのテーマシステムを採用しています。

---
*作成日: 2026/02/06*
*作成者: Antigravity AI Assistant*
